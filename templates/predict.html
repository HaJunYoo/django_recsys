{% extends "base.html" %}
{% load static %}

{% block main %}

<style>

.container h1 {
    font-family: "Nanum Gothic";
    font-weight: bolder;
}

.container .form-group {
    font-family: "Nanum Gothic";
}

.container label {
    font-weight: bolder;
}

</style>


<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Contents-Topic based Recommendation Results</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">

                <div>name : <span id="name"></span></div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a class="btn btn-primary" href="/results" role="button">View DB</a>
            </div>
        </div>
    </div>
</div>

<h1 style="text-align: center; margin-top: 2rem; margin-bottom: 1rem;">Contents based Recommendation Input üçä</h1>
<hr>

<div class = "container">

<div class="container pt-5">
    <div class="row justify-content-md-center">
{#        column grid medium -> 12/4(3Î∂ÑÌï†) number of 4#}
        <div class="col-md-6">
            <form action="" id="post-form">
                {% csrf_token %}


                <div class="form-group">
                    <label for="main_category">Ïπ¥ÌÖåÍ≥†Î¶¨</label><br>

                    {% for elem in category_list  %}
                    <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="main_category" value={{ elem }}>
                    <label class="form-check-label" for="main_category">{{elem}}</label>
                    </div>
                    {%  endfor %}

                </div>



                <div class="form-group">
                    <label for="coordi">ÏΩîÎîî</label><br>

                    {% for elem in coordi_list  %}
                    <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="coordi" value={{ elem }}>
                    <label class="form-check-label" for="coordi">{{elem}}</label>
                    </div>
                    {%  endfor %}
                    <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="coordi" value="">
                    <label class="form-check-label" for="coordi">ÏóÜÏùå</label>
                    </div>

                </div>

                <div class="form-group">
                    <label for="input_text">ÌÇ§ÏõåÎìú ÏûÖÎ†•</label>
                    <input type="text" class="form-control" id="input_text"
                           placeholder="ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî (Ïòà : Ï°∞Í±∞Î∞îÏßÄ, Ìù∞Ìã∞)" required>
                </div>

                <div class="form-group">
                    <label for="top_n">Top-N</label>
                    <input type="number" step="0.1" class="form-control" id="top_n"
                           placeholder="ÏñëÏùò Ï†ïÏàòÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" required>
                </div>
                <button style ='margin-top: 2rem;' type="submit" value="Submit" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Ï†úÏ∂ú</button>
            </form>
        </div>

    </div>
</div>

</div>

<script>

    $(document).on('submit', '#post-form',function(e){
        // nameÏù¥ Í∞ôÏùÄ Ï≤¥ÌÅ¨Î∞ïÏä§Ïùò Í∞íÎì§ÏùÑ Î∞∞Ïó¥Ïóê Îã¥ÎäîÎã§.
        var main_category_checkboxValues = [];
        $("input[id='main_category']:checked").each( function(i) {
        main_category_checkboxValues.push($(this).val());
        });

        var coordi_checkboxValues = [];
        $("input[id='coordi']:checked").each( function(i) {
        coordi_checkboxValues.push($(this).val());
        });

        console.log(main_category_checkboxValues);
        console.log(coordi_checkboxValues);

        var main_category_string = main_category_checkboxValues.toString()
        var coordi_string = coordi_checkboxValues.toString()

        console.log(main_category_string);
        console.log(coordi_string);


        {# submit -> Ïó∞ÏáÑ Îã§Ïùå Ïù¥Î≤§Ìä∏ Î¨µÏÇ¥ -> ajax Ïã§Ìñâ #}
        e.preventDefault();

        $.ajax({
            type:'POST',
            {#app = predict, reference url namespace => submit_prediction #}

            url:'{% url "predict:prediction_page" %}',
            data:{
                input_text:$('#input_text').val(),
                topn:$('#top_n').val(),
                {#age:$('#age').val(),#}
                {#gender:$('#gender').val(),#}

                coordi: coordi_string,
                main_category: main_category_string,

                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                action: 'post'
            },

            success:function(json) {
                {#form Î≥¥ÎÉÑÏù¥ ÏÑ±Í≥µÌïòÎ©¥ Ï†ÅÏùÄ ÎÇ¥Ïö© ÏÇ¨ÎùºÏßê#}
                document.forms["post-form"].reset();
                alert('POST Success!');

                document.getElementById("name").innerHTML = json['name']
                {#document.getElementById("img").innerHTML = json['img']#}

            },
            error : function(xhr,errmsg,err) {
                console.log(error);
            }
        });
    })

</script>


{% endblock %}